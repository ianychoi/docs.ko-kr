---
ms.openlocfilehash: ab9431780422dfece5dcf8007d13e6d584f5118f
ms.sourcegitcommit: 721c3e4bdbb1ea0bb420818ec944c538fe5c513a
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 12/01/2020
ms.locfileid: "96476427"
---
### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a><span data-ttu-id="b2f8d-101">IWorkflowInstanceManagement.TransactedCancel 및 IWorkflowInstanceManagement.TransactedTerminate의 무한 재귀를 방지</span><span class="sxs-lookup"><span data-stu-id="b2f8d-101">Avoiding endless recursion for IWorkflowInstanceManagement.TransactedCancel and IWorkflowInstanceManagement.TransactedTerminate</span></span>

#### <a name="details"></a><span data-ttu-id="b2f8d-102">설명</span><span class="sxs-lookup"><span data-stu-id="b2f8d-102">Details</span></span>

<span data-ttu-id="b2f8d-103"><xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> 또는 <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> API를 사용하여 워크플로 인스턴스를 취소하거나 종료하는 경우에 워크플로 인스턴스는 `Workflow` 런타임이 요청 처리의 일부로 서비스 인스턴스를 유지하려 할 때 무한 재귀로 인해 스택 오버플로가 발생할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-103">Under some circumstances when using <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> APIs to cancel or terminate a workflow service instance, the workflow instance may encounter a stack overflow due to endless recursion when the `Workflow` runtime attempts to persist the service instance as part of processing the request.</span></span> <span data-ttu-id="b2f8d-104">워크플로 인스턴스가 다른 서비스에 대한 기타 미처리 WCF 요청이 완료되기를 기다리고 있는 상태인 경우 문제가 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-104">The problem occurs if the workflow instance is in a state where it is waiting for some other outstanding WCF request to another service to complete.</span></span> <span data-ttu-id="b2f8d-105">`TransactedCancel` 및 `TransactedTerminate` 작업은 워크플로 서비스 인스턴스에 대해 큐 대기 중인 작업 항목을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-105">The `TransactedCancel` and `TransactedTerminate` operations create work items that are queued for the workflow service instance.</span></span> <span data-ttu-id="b2f8d-106">이러한 작업 항목은 `TransactedCancel/TransactedTerminate` 요청 처리의 일부로 실행되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-106">These work items are not executed as part of the processing of the `TransactedCancel/TransactedTerminate` request.</span></span> <span data-ttu-id="b2f8d-107">워크플로 서비스 인스턴스는 기타 처리 중인 WCF 요청이 완료되기를 기다리느라 사용 중이므로 만든 작업 항목은 큐 대기 상태를 유지합니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-107">Because the workflow service instance is busy waiting for the other outstanding WCF request to complete, the work item created remains queued.</span></span> <span data-ttu-id="b2f8d-108">`TransactedCancel/TransactedTerminate` 작업이 완료되고 컨트롤이 다시 클라이언트로 반환됩니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-108">The `TransactedCancel/TransactedTerminate` operation completes and control is returned back to the client.</span></span> <span data-ttu-id="b2f8d-109">`TransactedCancel/TransactedTerminate` 작업과 연관된 트랜잭션이 커밋하려 하는 경우 워크플로 서비스 인스턴스 상태를 유지해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-109">When the transaction associated with the `TransactedCancel/TransactedTerminate` operation attempts to commit, it needs to persist the workflow service instance state.</span></span> <span data-ttu-id="b2f8d-110">그러나 인스턴스에 대해 처리 중인 `WCF` 요청이 있기 때문에 워크플로 런타임은 워크플로 서비스 인스턴스를 지속할 수 없고 무한 재귀 루프는 스택 오버플로로 이어집니다. `TransactedCancel` 및 `TransactedTerminate`만 메모리에 작업 항목을 만드므로 트랜잭션이 존재한다는 팩트는 아무 영향도 줄 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-110">But because there is an outstanding `WCF` request for the instance, the Workflow runtime cannot persist the workflow service instance, and an endless recursion loop leads to the stack overflow.Because `TransactedCancel` and `TransactedTerminate` only create a work item in memory, the fact that a transaction exists doesn't have any effect.</span></span> <span data-ttu-id="b2f8d-111">트랜잭션 롤백은 작업 항목을 삭제하지 않습니다. 이 문제를 해결하기 위해 .NET Framework 4.7.2부터 `TransactedCancel` 및 `TransactedTerminate`에 대한 트랜잭션을 무시하도록 지시하는 워크플로 서비스의 `web.config/app.config`에 추가될 수 있는 `AppSetting`을 도입했습니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-111">A rollback of the transaction does not discard the work item.To address this issue, starting in .NET Framework 4.7.2, we have introduced an `AppSetting` that can be added to the `web.config/app.config` of the workflow service that tells it to ignore transactions for `TransactedCancel` and `TransactedTerminate`.</span></span> <span data-ttu-id="b2f8d-112">이렇게 하면 트랜잭션이 워크플로 인스턴스가 유지되기를 기다리지 않고 커밋할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-112">This allows the transaction to commit without waiting for the workflow instance to persist.</span></span> <span data-ttu-id="b2f8d-113">이 기능에 대한 AppSetting은 `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate`입니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-113">The AppSetting for this feature is named `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate`.</span></span> <span data-ttu-id="b2f8d-114">`true` 값은 트랜잭션을 무시하고 따라서 스택 오버플로를 방지해야 한다는 것을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-114">A value of `true` indicates that the transaction should be ignored, thus avoiding the stack overflow.</span></span> <span data-ttu-id="b2f8d-115">이 AppSetting의 기본값은 `false`이므로 기존 워크플로 서비스 인스턴스는 영향을 받지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-115">The default value of this AppSetting is `false`, so existing workflow service instances are not affected.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="b2f8d-116">제안 해결 방법</span><span class="sxs-lookup"><span data-stu-id="b2f8d-116">Suggestion</span></span>

<span data-ttu-id="b2f8d-117">AppFabric 또는 다른 <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> 클라이언트를 사용하고, 워크플로 인스턴스를 취소하거나 종료하려고 할 때 워크플로 서비스 인스턴스에서 스택 오버플로가 발생하는 경우 워크플로 서비스에 대한 web.config/app.config 파일의 `<appSettings>` 섹션에 다음을 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-117">If you are using AppFabric or another <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> client and are encountering a stack overflow in the workflow service instance when trying to cancel or terminate a workflow instance, you can add the following to the `<appSettings>` section of the web.config/app.config file for the workflow service:</span></span>

<pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre>

<span data-ttu-id="b2f8d-118">문제가 발생하지 않는 경우 이 작업을 수행할 필요가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="b2f8d-118">If you are not encountering the problem, you do not need to do this.</span></span>

| <span data-ttu-id="b2f8d-119">이름</span><span class="sxs-lookup"><span data-stu-id="b2f8d-119">Name</span></span>    | <span data-ttu-id="b2f8d-120">값</span><span class="sxs-lookup"><span data-stu-id="b2f8d-120">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="b2f8d-121">Scope</span><span class="sxs-lookup"><span data-stu-id="b2f8d-121">Scope</span></span>   | <span data-ttu-id="b2f8d-122">Microsoft Edge</span><span class="sxs-lookup"><span data-stu-id="b2f8d-122">Edge</span></span>        |
| <span data-ttu-id="b2f8d-123">버전</span><span class="sxs-lookup"><span data-stu-id="b2f8d-123">Version</span></span> | <span data-ttu-id="b2f8d-124">4.7.2</span><span class="sxs-lookup"><span data-stu-id="b2f8d-124">4.7.2</span></span>       |
| <span data-ttu-id="b2f8d-125">형식</span><span class="sxs-lookup"><span data-stu-id="b2f8d-125">Type</span></span>    | <span data-ttu-id="b2f8d-126">대상 변경</span><span class="sxs-lookup"><span data-stu-id="b2f8d-126">Retargeting</span></span> |
