---
title: WF에서 비동기 활동 만들기
description: 파생 작업이 비동기 실행 논리를 구현할 수 있도록 하는 AsyncCodeActivity을 사용 하 여 사용자 지정 비동기 작업을 만드는 방법에 대해 알아봅니다.
ms.date: 03/30/2017
ms.assetid: 497e81ed-5eef-460c-ba55-fae73c05824f
ms.openlocfilehash: a03fbde1ff27084cc36dffc3a1912220d9bbca7e
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96242086"
---
# <a name="creating-asynchronous-activities-in-wf"></a><span data-ttu-id="a9763-103">WF에서 비동기 활동 만들기</span><span class="sxs-lookup"><span data-stu-id="a9763-103">Creating Asynchronous Activities in WF</span></span>

<span data-ttu-id="a9763-104"><xref:System.Activities.AsyncCodeActivity>는 활동 작성자가 파생 활동에서 비동기 실행 논리를 구현하는 데 사용할 수 있는 기본 클래스를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-104"><xref:System.Activities.AsyncCodeActivity> provides activity authors a base class to use that enables derived activities to implement asynchronous execution logic.</span></span> <span data-ttu-id="a9763-105">이 기능은 워크플로 스케줄러 스레드를 유지하지 않고 병렬로 실행 가능한 활동을 차단하지 않으면서 비동기 작업을 수행해야 하는 사용자 지정 활동에 유용합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-105">This is useful for custom activities that must perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span> <span data-ttu-id="a9763-106">이 항목에서는 <xref:System.Activities.AsyncCodeActivity>를 사용하여 사용자 지정 비동기 활동을 만드는 방법을 간략하게 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-106">This topic provides an overview of how to create custom asynchronous activities using <xref:System.Activities.AsyncCodeActivity>.</span></span>  
  
## <a name="using-asynccodeactivity"></a><span data-ttu-id="a9763-107">AsyncCodeActivity 사용</span><span class="sxs-lookup"><span data-stu-id="a9763-107">Using AsyncCodeActivity</span></span>  

 <span data-ttu-id="a9763-108"><xref:System.Activities?displayProperty=nameWithType>는 사용자 지정 활동 작성자에게 활동 작성 요구 사항별로 다른 기본 클래스를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-108"><xref:System.Activities?displayProperty=nameWithType> provides custom activity authors with different base classes for different activity authoring requirements.</span></span> <span data-ttu-id="a9763-109">각 클래스는 특정 체계를 따르고 워크플로 작성자 및 활동 런타임에 해당 계약을 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-109">Each one carries a particular semantic and provides a workflow author (and the activity runtime) a corresponding contract.</span></span> <span data-ttu-id="a9763-110"><xref:System.Activities.AsyncCodeActivity> 기반 활동은 스케줄러 스레드를 기준으로 비동기 작업을 수행하고 실행 논리가 관리 코드에 표시되는 활동입니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-110">An <xref:System.Activities.AsyncCodeActivity> based activity is an activity that performs work asynchronously relative to the scheduler thread and whose execution logic is expressed in managed code.</span></span> <span data-ttu-id="a9763-111">비동기 처리로 인해 <xref:System.Activities.AsyncCodeActivity>에서 실행 중에 유휴 지점이 발생할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-111">As a result of going asynchronous, an <xref:System.Activities.AsyncCodeActivity> may induce an idle point during execution.</span></span> <span data-ttu-id="a9763-112">비동기 작업의 일시적 특성으로 인해 <xref:System.Activities.AsyncCodeActivity>는 활동 실행 기간 동안 항상 비지속성 블록을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-112">Due to the volatile nature of asynchronous work, an <xref:System.Activities.AsyncCodeActivity> always creates a no persist block for the duration of the activity’s execution.</span></span> <span data-ttu-id="a9763-113">따라서 비동기 작업 중에 워크플로 런타임에 워크플로 인스턴스가 유지되지 않을 뿐만 아니라 비동기 코드를 실행하는 동안 워크플로 인스턴스가 언로드되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-113">This prevents the workflow runtime from persisting the workflow instance in the middle of the asynchronous work, and also prevents the workflow instance from unloading while the asynchronous code is executing.</span></span>  
  
### <a name="asynccodeactivity-methods"></a><span data-ttu-id="a9763-114">AsyncCodeActivity 메서드</span><span class="sxs-lookup"><span data-stu-id="a9763-114">AsyncCodeActivity Methods</span></span>  

 <span data-ttu-id="a9763-115"><xref:System.Activities.AsyncCodeActivity>에서 파생되는 활동은 사용자 지정 코드로 <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> 및 <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> 메서드를 재정의하여 비동기 실행 논리를 만들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-115">Activities that derive from <xref:System.Activities.AsyncCodeActivity> can create asynchronous execution logic by overriding the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> methods with custom code.</span></span> <span data-ttu-id="a9763-116">런타임에 의해 호출되면 이러한 메서드가 <xref:System.Activities.AsyncCodeActivityContext>에 전달됩니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-116">When called by the runtime, these methods are passed an <xref:System.Activities.AsyncCodeActivityContext>.</span></span> <span data-ttu-id="a9763-117"><xref:System.Activities.AsyncCodeActivityContext>활동 작성자가 <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> /  <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> 컨텍스트의 속성에서 공유 상태를 제공할 수 있도록 합니다 <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> .</span><span class="sxs-lookup"><span data-stu-id="a9763-117"><xref:System.Activities.AsyncCodeActivityContext> allows the activity author to provide shared state across <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/ <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> in the context’s <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> property.</span></span> <span data-ttu-id="a9763-118">다음 예제에서 `GenerateRandom` 활동은 난수를 비동기적으로 생성합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-118">In the following example, a `GenerateRandom` activity generates a random number asynchronously.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#8](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#8)]  
  
 <span data-ttu-id="a9763-119">이전 예제 활동은 <xref:System.Activities.AsyncCodeActivity%601>에서 파생되며 `OutArgument<int>`라는 높은 `Result`를 갖습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-119">The previous example activity derives from <xref:System.Activities.AsyncCodeActivity%601>, and has an elevated `OutArgument<int>` named `Result`.</span></span> <span data-ttu-id="a9763-120">`GetRandom` 메서드에 의해 반환되는 값은 <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> 재정의를 통해 추출되어 반환되며, 이 값이 `Result` 값으로 설정됩니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-120">The value returned by the `GetRandom` method is extracted and returned by the <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override, and this value is set as the `Result` value.</span></span> <span data-ttu-id="a9763-121">결과를 반환하지 않는 비동기 활동은 <xref:System.Activities.AsyncCodeActivity>에서 파생되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-121">Asynchronous activities that do not return a result should derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="a9763-122">다음 예제에서는 `DisplayRandom`에서 파생되는 <xref:System.Activities.AsyncCodeActivity> 활동을 정의합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-122">In the following example, a `DisplayRandom` activity is defined which derives from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="a9763-123">이 활동은 `GetRandom` 활동과 비슷하지만 결과를 반환하는 대신 콘솔에 메시지를 표시합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-123">This activity is like the `GetRandom` activity but instead of returning a result it displays a message to the console.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#11](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#11)]  
  
 <span data-ttu-id="a9763-124">반환 값이 없으므로 `DisplayRandom`은 <xref:System.Action> 대신 <xref:System.Func%602>을 사용하여 대리자를 호출하고 대리자는 아무 값도 반환하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-124">Note that because there is no return value, `DisplayRandom` uses an <xref:System.Action> instead of a <xref:System.Func%602> to invoke its delegate, and the delegate returns no value.</span></span>  
  
 <span data-ttu-id="a9763-125">또한 <xref:System.Activities.AsyncCodeActivity>는 <xref:System.Activities.AsyncCodeActivity.Cancel%2A> 재정의를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-125"><xref:System.Activities.AsyncCodeActivity> also provides a <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override.</span></span> <span data-ttu-id="a9763-126"><xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> 및 <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>는 재정의가 필요하지만, <xref:System.Activities.AsyncCodeActivity.Cancel%2A>은 선택 사항이며, 활동에서 처리 중인 비동기 상태를 취소하거나 중단할 때 비동기 상태를 정리할 수 있도록 재정의할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-126">While <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> are required overrides, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> is optional, and can be overridden so the activity can clean up its outstanding asynchronous state when it is being canceled or aborted.</span></span> <span data-ttu-id="a9763-127">정리할 수 있고 `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested`가 `true`이면 활동에서 <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>를 호출해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-127">If clean up is possible and `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` is `true`, the activity should call <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span></span> <span data-ttu-id="a9763-128">이 메서드에서 throw되는 예외는 워크플로 인스턴스에 치명적입니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-128">Any exceptions thrown from this method are fatal to the workflow instance.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#10)]  
  
### <a name="invoking-asynchronous-methods-on-a-class"></a><span data-ttu-id="a9763-129">클래스에 대한 비동기 메서드 호출</span><span class="sxs-lookup"><span data-stu-id="a9763-129">Invoking Asynchronous Methods on a Class</span></span>  

 <span data-ttu-id="a9763-130">.NET Framework의 많은 클래스는 비동기 기능을 제공 하며,이 기능은 기반 활동을 사용 하 여 비동기적으로 호출할 수 있습니다 <xref:System.Activities.AsyncCodeActivity> .</span><span class="sxs-lookup"><span data-stu-id="a9763-130">Many of the classes in the .NET Framework provide asynchronous functionality, and this functionality can be asynchronously invoked by using an <xref:System.Activities.AsyncCodeActivity> based activity.</span></span> <span data-ttu-id="a9763-131">다음 예제에서는 클래스를 사용 하 여 비동기적으로 파일을 만드는 활동을 만듭니다 <xref:System.IO.FileStream> .</span><span class="sxs-lookup"><span data-stu-id="a9763-131">In the following example, an activity is created that asynchronously creates a file by using the <xref:System.IO.FileStream> class.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#12](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#12)]  
  
### <a name="sharing-state-between-the-beginexecute-and-endexecute-methods"></a><span data-ttu-id="a9763-132">BeginExecute 및 EndExecute 메서드 간에 상태 공유</span><span class="sxs-lookup"><span data-stu-id="a9763-132">Sharing State Between the BeginExecute and EndExecute Methods</span></span>  

 <span data-ttu-id="a9763-133">앞의 예제에서 <xref:System.IO.FileStream>에서 만든 <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> 개체는 <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>에서 액세스합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-133">In the previous example, the <xref:System.IO.FileStream> object that was created in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> was accessed in the <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="a9763-134">이는 `file` 변수가 <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType>에서 <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> 속성에 전달되기 때문입니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-134">This is possible because the `file` variable was passed in the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> property in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="a9763-135">이는 <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>와 <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> 간의 상태 공유에 올바른 메서드입니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-135">This is the correct method for sharing state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="a9763-136">파생 클래스(`FileWriter` in this case)에서 멤버 변수를 사용하여 <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>와 <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>간에 상태를 공유하는 것은 활동 개체가 여러 활동 인스턴스에서 참조될 수 있으므로 잘못된 것입니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-136">It is incorrect to use a member variable in the derived class (`FileWriter` in this case) to share state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> because the activity object may be referenced by multiple activity instances.</span></span> <span data-ttu-id="a9763-137">멤버 변수를 사용하여 상태를 공유하려고 시도한 경우 어떤 <xref:System.Activities.ActivityInstance>의 값이 다른 <xref:System.Activities.ActivityInstance>의 값을 덮어쓰거나 사용하게 될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-137">Attempting to use a member variable to share state can result in values from one <xref:System.Activities.ActivityInstance> overwriting or consuming values from another <xref:System.Activities.ActivityInstance>.</span></span>  
  
### <a name="accessing-argument-values"></a><span data-ttu-id="a9763-138">인수 값 액세스</span><span class="sxs-lookup"><span data-stu-id="a9763-138">Accessing Argument Values</span></span>  

 <span data-ttu-id="a9763-139"><xref:System.Activities.AsyncCodeActivity> 환경은 활동에 정의된 인수들로 구성됩니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-139">The environment of an <xref:System.Activities.AsyncCodeActivity> consists of the arguments defined on the activity.</span></span> <span data-ttu-id="a9763-140">이러한 인수 <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> / <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> 는 매개 변수를 사용 하 여 재정의에서 액세스할 수 있습니다 <xref:System.Activities.AsyncCodeActivityContext> .</span><span class="sxs-lookup"><span data-stu-id="a9763-140">These arguments can be accessed from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/<xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides using the <xref:System.Activities.AsyncCodeActivityContext> parameter.</span></span> <span data-ttu-id="a9763-141">대리자에서는 인수에 액세스할 수 없지만 해당 매개 변수를 사용하여 인수 값 또는 원하는 다른 데이터를 대리자에 전달할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-141">The arguments cannot be accessed in the delegate, but the argument values or any other desired data can be passed in to the delegate using its parameters.</span></span> <span data-ttu-id="a9763-142">다음 예제에서는 `Max` 인수에서 상한(포함)을 가져오는 난수 생성 활동을 정의합니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-142">In the following example, a random number-generating activity is defined that obtains the inclusive upper bound from its `Max` argument.</span></span> <span data-ttu-id="a9763-143">대리자를 호출하면 인수 값이 비동기 코드에 전달됩니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-143">The value of the argument is passed in to the asynchronous code when the delegate is invoked.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#9](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#9)]  
  
### <a name="scheduling-actions-or-child-activities-using-asynccodeactivity"></a><span data-ttu-id="a9763-144">AsyncCodeActivity를 사용하여 작업 또는 자식 활동 예약</span><span class="sxs-lookup"><span data-stu-id="a9763-144">Scheduling Actions or Child Activities Using AsyncCodeActivity</span></span>  

 <span data-ttu-id="a9763-145"><xref:System.Activities.AsyncCodeActivity> 파생 사용자 지정 활동은 워크플로 스레드와 관련하여 작업을 비동기식으로 수행하는 메서드를 제공하지만 자식 활동이나 작업을 예약하는 기능은 제공하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-145"><xref:System.Activities.AsyncCodeActivity> derived custom activities  provide a method for performing work asynchronously with regard to the workflow thread, but do not provide the ability to schedule child activities or actions.</span></span> <span data-ttu-id="a9763-146">단 비동기식 동작은 구성을 통해 자식 활동의 예약으로 통합할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-146">However, asynchronous behavior can be incorporated with scheduling of child activities through composition.</span></span> <span data-ttu-id="a9763-147">비동기 작업을 만든 다음 <xref:System.Activities.Activity> 또는 <xref:System.Activities.NativeActivity> 파생 작업을 통해 구성하여 비동기식 동작을 제공하고 자식 활동 또는 작업을 예약할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-147">An asynchronous activity can be created, and then composed with an <xref:System.Activities.Activity> or <xref:System.Activities.NativeActivity> derived activity to provide asynchronous behavior and scheduling of child activities or actions.</span></span> <span data-ttu-id="a9763-148">예를 들어 <xref:System.Activities.Activity>에서 파생되고, 활동의 논리를 구현하는 다른 활동뿐만 아니라 비동기 활동을 포함하는 <xref:System.Activities.Statements.Sequence> 구현으로 포함되도록 활동을 만들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a9763-148">For example, an activity could be created that derives from <xref:System.Activities.Activity>, and has as its implementation a <xref:System.Activities.Statements.Sequence> containing the asynchronous activity as well the other activities that implement the logic of the activity.</span></span> <span data-ttu-id="a9763-149">및를 사용 하 여 작업을 작성 하는 방법에 대 한 자세한 예제 <xref:System.Activities.Activity> <xref:System.Activities.NativeActivity> [는 방법: 작업](how-to-create-an-activity.md) 및 [활동 제작 옵션](activity-authoring-options-in-wf.md)만들기를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="a9763-149">For more examples of composing activities using <xref:System.Activities.Activity> and <xref:System.Activities.NativeActivity>, see [How to: Create an Activity](how-to-create-an-activity.md) and [Activity Authoring Options](activity-authoring-options-in-wf.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a9763-150">참고 항목</span><span class="sxs-lookup"><span data-stu-id="a9763-150">See also</span></span>

- <xref:System.Action>
- <xref:System.Func%602>
