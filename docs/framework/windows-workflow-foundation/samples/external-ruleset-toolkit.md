---
description: '자세히 알아보기: 외부 규칙 집합 Toolkit'
title: External RuleSet Toolkit
ms.date: 03/30/2017
ms.assetid: a306d283-a031-475e-aa01-9ae86e7adcb0
ms.openlocfilehash: 41ee739ee90ba6dc1583369930919816e9afd53b
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 02/06/2021
ms.locfileid: "99755384"
---
# <a name="external-ruleset-toolkit"></a><span data-ttu-id="a72d1-103">External RuleSet Toolkit</span><span class="sxs-lookup"><span data-stu-id="a72d1-103">External Ruleset Toolkit</span></span>

<span data-ttu-id="a72d1-104">일반적으로 워크플로 애플리케이션 내에서 규칙이 사용될 경우 해당 규칙은 어셈블리의 일부입니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-104">Normally when rules are used within a workflow application, the rules are part of the assembly.</span></span> <span data-ttu-id="a72d1-105">일부 시나리오에서는 워크플로 어셈블리를 다시 빌드하고 배포하지 않고도 RuleSet을 업데이트할 수 있도록 어셈블리와 별도로 RuleSet을 유지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-105">In some scenarios, you may want to maintain the RuleSets separately from the assembly so that they can be updated without rebuilding and deploying the workflow assembly.</span></span> <span data-ttu-id="a72d1-106">이 샘플에서는 데이터베이스에 있는 RuleSet을 관리하고 편집하며 런타임에 워크플로에서 이러한 RuleSet에 액세스할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-106">This sample allows you to manage and edit RuleSets in a database and access those RuleSets from a workflow at runtime.</span></span> <span data-ttu-id="a72d1-107">따라서 워크플로 인스턴스를 실행하여 RuleSet 변경 내용을 자동으로 통합할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-107">This enables running workflow instances to automatically incorporate RuleSet changes.</span></span>

<span data-ttu-id="a72d1-108">External RuleSet Toolkit 샘플에는 데이터베이스에서 RuleSet 버전을 관리하고 편집하는 데 사용할 수 있는 Windows Forms 기반 도구가 포함되어 있으며,</span><span class="sxs-lookup"><span data-stu-id="a72d1-108">The External RuleSet Toolkit sample contains a Windows Forms-based tool that you can use to manage and edit RuleSet versions in a database.</span></span> <span data-ttu-id="a72d1-109">해당 규칙을 실행하는 호스트 서비스 및 활동도 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-109">It also includes an activity and a host service for executing those rules.</span></span>

> [!NOTE]
> <span data-ttu-id="a72d1-110">이 샘플에는 [Microsoft SQL Server](/sql)필요 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-110">This sample requires [Microsoft SQL Server](/sql).</span></span>

<span data-ttu-id="a72d1-111">Visual Studio는 Windows Workflow Foundation (WF)의 일부로 규칙 집합 편집기를 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-111">Visual Studio provides a RuleSet editor as part of the Windows Workflow Foundation (WF).</span></span> <span data-ttu-id="a72d1-112">이 편집기는 워크플로의 `Policy` 활동을 두 번 클릭하여 시작할 수 있으며 정의된 RuleSet 개체를 워크플로와 연결된 .rules 파일로 serialize합니다. `Policy` 활동은 워크플로에 대해 RuleSet 인스턴스를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-112">You can start this editor by double-clicking the `Policy` activity in a workflow; it serializes the defined RuleSet object to the .rules file associated with the workflow (a `Policy` activity runs a RuleSet instance against the workflow).</span></span> <span data-ttu-id="a72d1-113">.rules 파일은 워크플로 프로젝트를 빌드할 때 리소스로 어셈블리에 컴파일됩니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-113">The .rules file is compiled into the assembly as a resource when you build the workflow project.</span></span>

<span data-ttu-id="a72d1-114">이 샘플의 구성 요소는 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-114">The components of this sample include:</span></span>

- <span data-ttu-id="a72d1-115">데이터베이스에서 RuleSet 버전을 편집하고 관리하는 데 사용할 수 있는 RuleSet 그래픽 사용자 인터페이스</span><span class="sxs-lookup"><span data-stu-id="a72d1-115">A RuleSet graphical user interface tool that you can use to edit and manage RuleSet versions in the database.</span></span>

- <span data-ttu-id="a72d1-116">호스트 애플리케이션에서 구성되고 데이터베이스에서 RuleSet에 액세스하는 RuleSet 서비스</span><span class="sxs-lookup"><span data-stu-id="a72d1-116">A RuleSet service that is configured on the host application and accesses RuleSets from the database.</span></span>

- <span data-ttu-id="a72d1-117">RuleSet 서비스에서 RuleSet을 요청하고 워크플로에 대해 RuleSet을 실행하는 `ExternalPolicy` 활동</span><span class="sxs-lookup"><span data-stu-id="a72d1-117">An `ExternalPolicy` activity that requests a RuleSet from the RuleSet service and runs the RuleSet against the workflow.</span></span>

<span data-ttu-id="a72d1-118">구성 요소의 상호 작용은 다음 그림에 나와 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-118">The interaction of the components is shown in the following image.</span></span> <span data-ttu-id="a72d1-119">그 뒤에 나오는 단원에서는 각 구성 요소에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-119">The sections that follow describe each component.</span></span>

![외부 규칙 집합 도구 키트 샘플 개요를 보여 주는 다이어그램입니다.](./media/external-ruleset-toolkit/ruleset-toolkit-overview.gif)

> [!IMPORTANT]
> <span data-ttu-id="a72d1-121">컴퓨터에 이 샘플이 이미 설치되어 있을 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-121">The samples may already be installed on your machine.</span></span> <span data-ttu-id="a72d1-122">계속하기 전에 다음(기본) 디렉터리를 확인하세요.</span><span class="sxs-lookup"><span data-stu-id="a72d1-122">Check for the following (default) directory before continuing.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples`
>
> <span data-ttu-id="a72d1-123">이 디렉터리가 없는 경우 [.NET Framework 4에 대 한 Windows Communication Foundation (wcf) 및 Windows Workflow Foundation (WF) 샘플](https://www.microsoft.com/download/details.aspx?id=21459) 로 이동 하 여 모든 WINDOWS COMMUNICATION FOUNDATION (wcf) 및 샘플을 다운로드 [!INCLUDE[wf1](../../../../includes/wf1-md.md)] 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-123">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="a72d1-124">이 샘플은 다음 디렉터리에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-124">This sample is located in the following directory.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\ExternalRuleSetToolKit`

## <a name="ruleset-tool"></a><span data-ttu-id="a72d1-125">RuleSet 도구</span><span class="sxs-lookup"><span data-stu-id="a72d1-125">RuleSet Tool</span></span>

<span data-ttu-id="a72d1-126">다음 이미지는 규칙 집합 도구의 스크린샷입니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-126">The following image is a screenshot of the RuleSet tool.</span></span> <span data-ttu-id="a72d1-127">**규칙 저장소** 메뉴를 통해 데이터베이스에서 사용 가능한 규칙 집합을 로드 하 고 수정 된 규칙 집합을 저장소에 다시 저장할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-127">From the **Rule Store** menu, you can load the available RuleSets from the database and save modified RuleSets back to the store.</span></span> <span data-ttu-id="a72d1-128">애플리케이션 구성 파일에서는 RuleSet 데이터베이스에 대한 데이터베이스 연결 문자열을 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-128">An application configuration file provides a database connection string for the RuleSet database.</span></span> <span data-ttu-id="a72d1-129">도구를 시작하면 구성된 데이터베이스에서 RuleSet이 자동으로 로드됩니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-129">When you start the tool, it automatically loads the RuleSets from the configured database.</span></span>

![규칙 집합 브라우저를 보여 주는 스크린샷](./media/external-ruleset-toolkit/ruleset-browser-dialog.gif)

<span data-ttu-id="a72d1-131">RuleSet 도구에서는 RuleSet에 주 버전 및 부 버전 번호를 적용하여 동시에 여러 버전을 유지하고 저장할 수 있게 합니다. 이 도구에서는 버전 관리 기능 이외에 잠금이나 기타 구성 관리 기능을 제공하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-131">The RuleSet tool applies major and minor version numbers to the RuleSets, allowing you to simultaneously maintain and store multiple versions (the tool provides no locking or other configuration management features in addition to the versioning capability).</span></span> <span data-ttu-id="a72d1-132">이 도구를 사용하여 새 RuleSet 버전을 만들거나 기존 버전을 삭제할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-132">Using the tool, you can create new RuleSet versions or delete existing versions.</span></span> <span data-ttu-id="a72d1-133">**새로 만들기** 를 클릭 하면 도구에서 새 규칙 집합 이름을 만들고 버전 1.0을 적용 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-133">When you click **New**, the tool creates a new RuleSet name and applies version 1.0.</span></span> <span data-ttu-id="a72d1-134">버전을 복사하면 도구에서 포함된 규칙을 비롯하여 선택한 RuleSet 버전의 복사본을 만들고 고유한 새 버전 번호를 할당합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-134">When you copy a version, the tool creates a copy of the selected RuleSet version, including the contained rules, and assigns new, unique version numbers.</span></span> <span data-ttu-id="a72d1-135">이러한 버전 번호는 기존 RuleSet의 버전 번호를 기반으로 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-135">These version numbers are based on the version numbers of existing RuleSets.</span></span> <span data-ttu-id="a72d1-136">양식에서 연결된 필드를 사용하여 RuleSet 이름 및 버전 번호를 변경할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-136">You can change the RuleSet name and version numbers using the associated fields on the form.</span></span>

<span data-ttu-id="a72d1-137">**규칙 편집** 을 클릭 하면 다음 이미지와 같이 규칙 집합 편집기가 시작 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-137">When you click **Edit Rules**, the RuleSet editor starts, as shown in the following image:</span></span>

![규칙 집합 편집기를 보여 주는 스크린샷](./media/external-ruleset-toolkit/ruleset-editor-dialog.gif)

<span data-ttu-id="a72d1-139">이는 Visual Studio 추가 기능 Windows Workflow Foundation의 일부인 편집기 대화 상자를 다시 호스팅하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-139">This is a re-hosting of the editor dialog that is part of the Windows Workflow Foundation Visual Studio add-in.</span></span> <span data-ttu-id="a72d1-140">Intellisense 지원을 비롯하여 편집기 대화 상자와 동일한 기능을 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-140">It provides the same functionality, including Intellisense support.</span></span> <span data-ttu-id="a72d1-141">규칙은 도구에서 규칙 집합에 연결 된 대상 유형 (예: 워크플로)에 대해 작성 됩니다. 주 도구 대화 상자에서 **찾아보기** 를 클릭 하면 그림 4에 표시 된 것 처럼 **워크플로/형식 선택기** 대화 상자가 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-141">The rules are authored against a target type (such as a workflow) that is associated with the RuleSet in the tool; when you click **Browse** in the main tool dialog, the **Workflow/Type Selector** dialog appears, as shown in Figure 4.</span></span>

<span data-ttu-id="a72d1-142">![워크플로 &#47;유형 선택](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span><span class="sxs-lookup"><span data-stu-id="a72d1-142">![Workflow &#47;Type Selection](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span></span>

<span data-ttu-id="a72d1-143">그림 4: 워크플로/형식 선택기</span><span class="sxs-lookup"><span data-stu-id="a72d1-143">Figure 4: Workflow/Type Selector</span></span>

<span data-ttu-id="a72d1-144">**워크플로/형식 선택기** 대화 상자를 사용 하 여 어셈블리와 해당 어셈블리 내의 특정 형식을 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-144">You can use the **Workflow/Type Selector** dialog to specify an assembly and a specific type within that assembly.</span></span> <span data-ttu-id="a72d1-145">이 형식은 규칙이 제작 및 실행되는 대상 형식입니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-145">This type is the target type against which the rules are authored (and run).</span></span> <span data-ttu-id="a72d1-146">대부분의 경우 대상 형식은 워크플로나 다른 활동 형식입니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-146">In many cases, the target type is a workflow or some other activity type.</span></span> <span data-ttu-id="a72d1-147">그러나 .NET 형식에 대해 RuleSet을 실행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-147">However, you can run a RuleSet against any .NET type.</span></span>

<span data-ttu-id="a72d1-148">데이터베이스 `name are stored with the` 에서 규칙 집합이 검색 될 때 도구에서 대상 형식을 자동으로 로드 하기 때문에 데이터베이스의 형식 규칙 집합 및 어셈블리 파일에 대 한 경로입니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-148">The path to the assembly file and the type `name are stored with the` RuleSet in the database, so that when the RuleSet is retrieved from the database, the tool attempts to automatically load the target type.</span></span>

<span data-ttu-id="a72d1-149">**워크플로/형식 선택기** 대화 상자에서 **확인** 을 클릭 하면 대상 형식에 규칙에서 참조 하는 모든 멤버가 포함 되도록 규칙 집합에 대해 선택한 형식의 유효성을 검사 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-149">When you click **OK** in the **Workflow/Type Selector** dialog, it validates the selected type against the RuleSet, to ensure that the target type has all the members referenced by the rules.</span></span> <span data-ttu-id="a72d1-150">오류는 **유효성 검사 오류** 대화 상자에 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-150">Errors are shown in a **Validation Errors** dialog.</span></span> <span data-ttu-id="a72d1-151">오류가 발생 하더라도 변경을 계속 하도록 선택 하거나 **취소** 를 클릭할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-151">You can choose to continue with the change despite the errors, or click **Cancel**.</span></span> <span data-ttu-id="a72d1-152">주 도구 대화 상자의 **도구** 메뉴에서 **유효성 검사** 를 클릭 하 여 대상 활동에 대해 규칙 집합 버전의 유효성을 다시 검사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-152">From the **Tools** menu in the main tool dialog, you can click **Validate** to re-validate the RuleSet version against the target activity.</span></span>

![유효성 검사 오류 대화 상자를 보여 주는 스크린샷](./media/external-ruleset-toolkit/validation-errors-dialog.png)

<span data-ttu-id="a72d1-154">도구의 **데이터** 메뉴에서 규칙 집합을 가져오고 내보낼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-154">From the **Data** menu in the tool, you can import and export RuleSets.</span></span> <span data-ttu-id="a72d1-155">**가져오기** 를 클릭 하면 rules 파일을 선택할 수 있는 파일 선택 대화 상자가 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-155">When you click **Import**, a file-chooser dialog appears, from which you can select a .rules file.</span></span> <span data-ttu-id="a72d1-156">이 파일은 처음에 Visual Studio에서 만든 파일 일 수도 있고 그렇지 않을 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-156">This may or may not be a file initially created in Visual Studio.</span></span> <span data-ttu-id="a72d1-157">.rules 파일에는 조건 컬렉션과 RuleSet 컬렉션을 포함하는 serialize된 `RuleDefinitions` 인스턴스가 포함되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-157">The .rules file should contain a serialized `RuleDefinitions` instance that contains a collection of conditions and a collection of RuleSets.</span></span> <span data-ttu-id="a72d1-158">이 도구는 조건 컬렉션을 사용 하지 않지만 `RuleDefinitions` . rules 형식을 사용 하 여 Visual Studio 환경과의 상호 작용을 허용 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-158">The tool does not use the conditions collection, but it does use the `RuleDefinitions` .rules format to allow interaction with the Visual Studio environment.</span></span>

<span data-ttu-id="a72d1-159">Rules 파일을 선택한 후에는 규칙 **집합 선택기** 대화 상자가 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-159">After selecting a .rules file, a **RuleSet Selector** dialog appears.</span></span> <span data-ttu-id="a72d1-160">이 대화 상자를 사용하여 파일에서 가져올 RuleSet을 선택할 수 있습니다. 기본적으로 모든 RuleSet으로 지정되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-160">You can use the dialog to select the RuleSets from the file that you want to import (the default specifies all RuleSets).</span></span> <span data-ttu-id="a72d1-161">WF 프로젝트 내의 버전 관리는 어셈블리의 버전과 동일하기 때문에 .rules 파일의 RuleSet에는 버전 번호가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-161">RuleSets in the .rules file do not have version numbers, because their versioning within a WF project is the same as the version of the assembly.</span></span> <span data-ttu-id="a72d1-162">가져오기 프로세스 중에이 도구는 사용 가능한 다음 주 버전 번호를 자동으로 할당 합니다 (가져온 후 변경 가능). **규칙 집합 선택기** 목록에서 할당 된 버전 번호를 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-162">During the importing process, the tool automatically assigns the next available major version number (which you can change after importing); you can see the assigned version numbers in the **RuleSet Selector** list.</span></span>

<span data-ttu-id="a72d1-163">도구는 가져오는 각 RuleSet에 대해 RuleSet에 사용된 멤버를 기반으로 .rules 파일(있는 경우)의 위치 아래에 있는 bin\Debug 폴더에서 연결된 형식을 찾으려고 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-163">For each RuleSet it imports, the tool attempts to locate the associated type from the bin\Debug folder under the location of the .rules file (if it exists), based on the members used in the RuleSet.</span></span> <span data-ttu-id="a72d1-164">RuleSet 도구에서 일치하는 형식을 여러 개 찾으면 .rules 파일 이름과 형식 이름이 일치하는 형식을 선택하려고 합니다. 예를 들어 `Workflow1` 형식은 Workflow1.rules에 대응합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-164">If the tool finds multiple matching types, it attempts to choose a type based on a match between the .rules file name and the type name (for example, the `Workflow1` type corresponds to Workflow1.rules).</span></span> <span data-ttu-id="a72d1-165">일치하는 항목이 여러 개 있으면 형식을 선택하라는 메시지가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-165">If multiple matches exist, you are prompted to select the type.</span></span> <span data-ttu-id="a72d1-166">이 자동 식별 메커니즘이 일치 하는 어셈블리나 유형을 찾지 못한 경우, 가져온 후 주 도구 대화 상자에서 **찾아보기** 를 클릭 하 여 연결 된 유형을 탐색할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-166">If this auto-identification mechanism fails to locate a matching assembly or type, then after importing you can click **Browse** on the main tool dialog to navigate to the associated type.</span></span> <span data-ttu-id="a72d1-167">다음 그림은 규칙 집합 선택기를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-167">The following image shows the RuleSet Selector:</span></span>

![규칙 집합 선택 대화 상자를 보여 주는 스크린샷](./media/external-ruleset-toolkit/ruleset-selector-dialog.gif)

<span data-ttu-id="a72d1-169">주 도구 메뉴에서 **데이터-내보내기** 를 클릭 하면 **규칙 집합 선택** 대화 상자가 다시 표시 됩니다 .이 대화 상자에서 내보낼 데이터베이스의 규칙 집합을 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-169">When you click **Data-Export** from the main tool menu, the **RuleSet Selector** dialog appears again, from which you can determine the RuleSets from the database that should be exported.</span></span> <span data-ttu-id="a72d1-170">**확인** 을 클릭 하면 결과 파일의 이름과 위치를 지정할 수 있는 **파일 저장** 대화 상자가 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-170">When you click **OK**, a **Save File** dialog appears, in which you can specify the name and location of the resulting .rules file.</span></span> <span data-ttu-id="a72d1-171">.rules 파일에는 버전 정보가 저장되지 않으므로 지정된 RuleSet 이름을 사용하는 RuleSet 버전을 하나만 선택할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-171">Because the .rules file does not contain version information, you can only select one RuleSet version with a given RuleSet name.</span></span>

## <a name="policyfromservice-activity"></a><span data-ttu-id="a72d1-172">PolicyFromService 활동</span><span class="sxs-lookup"><span data-stu-id="a72d1-172">PolicyFromService Activity</span></span>

<span data-ttu-id="a72d1-173">`PolicyFromService` 활동에 대한 코드는 간단합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-173">The code for the `PolicyFromService` activity is straightforward.</span></span> <span data-ttu-id="a72d1-174">이 활동은 WF와 함께 제공되는 `Policy` 활동과 매우 유사하게 작동하지만 .rules 파일에서 대상 RuleSet을 검색하는 대신 호스트 서비스를 호출하여 RuleSet 인스턴스를 가져옵니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-174">It works much like the `Policy` activity provided with WF, but instead of retrieving the target RuleSet from the .rules file, it calls a host service to obtain the RuleSet instance.</span></span> <span data-ttu-id="a72d1-175">그런 다음 루트 워크플로 활동 인스턴스에 대해 RuleSet을 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-175">It then runs the RuleSet against the root workflow activity instance.</span></span>

<span data-ttu-id="a72d1-176">워크플로에서 활동을 사용하려면 워크플로 프로젝트에서 `PolicyActivities` 및 `RuleSetService` 어셈블리에 참조를 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-176">To use the activity in a workflow, add a reference to the `PolicyActivities` and `RuleSetService` assemblies from your workflow project.</span></span> <span data-ttu-id="a72d1-177">도구 상자에 활동을 추가하는 방법에 대한 자세한 내용은 이 항목의 끝에 나오는 절차를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="a72d1-177">See the procedure at the end of this topic for a discussion of how to add the activity to the toolbox.</span></span>

<span data-ttu-id="a72d1-178">워크플로에 활동을 배치한 후에는 실행할 RuleSet의 이름을 제공해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-178">After placing the activity in your workflow, you must provide the name of the RuleSet to be run.</span></span> <span data-ttu-id="a72d1-179">리터럴 값으로 이름을 입력하거나 다른 활동의 워크플로 변수나 속성에 바인딩할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-179">You can enter the name as a literal value, or bind to a workflow variable or property of another activity.</span></span> <span data-ttu-id="a72d1-180">선택적으로 실행할 특정 RuleSet의 버전 번호를 입력할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-180">Optionally, you can enter version numbers for the specific RuleSet that should be run.</span></span> <span data-ttu-id="a72d1-181">주 버전 및 부 버전 번호의 기본값 0을 유지하면 데이터베이스의 최신 버전 번호가 자동으로 활동에 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-181">If you leave the default value of 0 for the major and minor version numbers, the latest version number in the database is automatically provided for the activity.</span></span>

## <a name="ruleset-service"></a><span data-ttu-id="a72d1-182">RuleSet 서비스</span><span class="sxs-lookup"><span data-stu-id="a72d1-182">RuleSet Service</span></span>

<span data-ttu-id="a72d1-183">이 서비스는 데이터베이스에서 RuleSet 버전을 검색하고 호출 활동에 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-183">The service is responsible for retrieving the specified RuleSet version from the database and returning it to the calling activity.</span></span> <span data-ttu-id="a72d1-184">앞에서 설명한 대로 `GetRuleSet` 호출에서 전달된 주 버전 및 부 버전 값이 둘 다 0이면 서비스에서는 최신 버전을 검색합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-184">As previously discussed, if the major and minor version values passed in the `GetRuleSet` call are both 0, the service retrieves the latest version.</span></span> <span data-ttu-id="a72d1-185">이때 RuleSet 정의나 인스턴스의 캐시가 없으며 마찬가지로 RuleSet 버전을 "배포됨"으로 표시하여 진행 중인 RuleSet과 구분하는 기능도 없습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-185">At this point, there is no caching of RuleSet definitions or instances; similarly, there are no features for marking RuleSet versions as "deployed" to differentiate them from in-progress RuleSets.</span></span>

<span data-ttu-id="a72d1-186">서비스에서 액세스할 데이터베이스는 애플리케이션 구성 파일을 사용하여 호스트에서 구성해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-186">The database to be accessed by the service should be configured on the host using an application configuration file.</span></span>

#### <a name="to-run-the-tool"></a><span data-ttu-id="a72d1-187">도구를 실행하려면</span><span class="sxs-lookup"><span data-stu-id="a72d1-187">To run the tool</span></span>

1. <span data-ttu-id="a72d1-188">도구 및 서비스에서 사용하는 RuleSet 테이블을 설정하는 폴더에 Setup.sql 파일이 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-188">The folder that sets up the RuleSet table used by the tool and the service contains a Setup.sql file.</span></span> <span data-ttu-id="a72d1-189">Setup.cmd 배치 파일을 실행하여 SQL Express에 규칙 데이터베이스를 만들고 RuleSet 테이블을 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-189">You can run the Setup.cmd batch file to create the Rules database on SQL Express and to set up the RuleSet table.</span></span>

2. <span data-ttu-id="a72d1-190">배치 파일이나 Setup.sql을 편집하고 SQL Express를 사용하지 않거나 `Rules`가 아닌 다른 이름의 데이터베이스에 테이블을 배치하도록 지정할 경우 RuleSet 도구와 `UsageSample` 프로젝트의 애플리케이션 구성 파일을 같은 정보로 편집해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-190">If you edit the batch file or Setup.sql and specify not to use SQL Express or to place the table in a database named something other than `Rules`, the application configuration files in the RuleSet tool and `UsageSample` projects should be edited with the same information.</span></span>

3. <span data-ttu-id="a72d1-191">Setup.sql 스크립트를 실행한 후에는 `ExternalRuleSetToolkit` 솔루션을 빌드하고 ExternalRuleSetTool 프로젝트에서 RuleSet 도구를 시작할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-191">After you run the Setup.sql script, you can build the `ExternalRuleSetToolkit` solution and then launch the RuleSet tool from the ExternalRuleSetTool project.</span></span>

4. <span data-ttu-id="a72d1-192">`RuleSetToolkitUsageSample` 순차 워크플로 콘솔 애플리케이션에는 샘플 워크플로가 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-192">The `RuleSetToolkitUsageSample` Sequential Workflow Console Application solution includes a sample workflow.</span></span> <span data-ttu-id="a72d1-193">워크플로는 대상 RuleSet이 실행되는 `PolicyFromService` 활동 및 두 가지 변수인 `orderValue`와 `discount`로 구성되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-193">The workflow consists of a `PolicyFromService` activity and two variables, `orderValue` and `discount`, against which the target RuleSet runs.</span></span>

5. <span data-ttu-id="a72d1-194">샘플을 사용하려면 `RuleSetToolkitUsageSample` 솔루션을 빌드합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-194">To use the sample, build the `RuleSetToolkitUsageSample` solution.</span></span> <span data-ttu-id="a72d1-195">그런 다음 규칙 집합 도구 주 메뉴에서 **데이터-가져오기** 를 클릭 하 고 RuleSetToolkitUsageSample 폴더에 있는 DiscountRuleSet 파일을 가리킵니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-195">Then from the RuleSet tool main menu, click **Data-Import** and point to the DiscountRuleSet.rules file in the RuleSetToolkitUsageSample folder.</span></span> <span data-ttu-id="a72d1-196">**규칙 저장소-저장** 메뉴 옵션을 클릭 하 여 가져온 규칙 집합을 데이터베이스에 저장 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-196">Click the **Rule Store-Save** menu option to save the imported RuleSet to the database.</span></span>

6. <span data-ttu-id="a72d1-197">`PolicyActivities` 어셈블리는 샘플 워크플로 프로젝트에서 참조되므로 `PolicyFromService` 활동이 워크플로에 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-197">Because the `PolicyActivities` assembly is referenced from the sample workflow project, the `PolicyFromService` activity appears in the workflow.</span></span> <span data-ttu-id="a72d1-198">그러나 기본적으로 도구 상자에는 나타나지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-198">It does not, however, appear in the toolbox by default.</span></span> <span data-ttu-id="a72d1-199">도구 상자에 추가하려면 다음을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-199">To add it to the toolbox, do the following:</span></span>

    - <span data-ttu-id="a72d1-200">도구 상자를 마우스 오른쪽 단추로 클릭 하 고 **항목 선택** 을 선택 합니다 (시간이 오래 걸릴 수 있음).</span><span class="sxs-lookup"><span data-stu-id="a72d1-200">Right-click the toolbox and select **Choose Items** (this may take a while).</span></span>

    - <span data-ttu-id="a72d1-201">**도구 상자 항목 선택** 대화 상자가 나타나면 **작업** 탭을 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-201">When the **Choose Toolbox Items** dialog appears, click the **Activities** tab.</span></span>

    - <span data-ttu-id="a72d1-202">`PolicyActivities`솔루션에서 어셈블리로 이동 `ExternalRuleSetToolkit` 하 고 **열기** 를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-202">Browse to the `PolicyActivities` assembly in the `ExternalRuleSetToolkit` solution and click **Open**.</span></span>

    - <span data-ttu-id="a72d1-203">`PolicyFromService` **도구 상자 항목 선택** 대화 상자에서 작업이 선택 되어 있는지 확인 한 다음 **확인** 을 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-203">Ensure that the `PolicyFromService` activity is selected in the **Choose Toolbox Items** dialog and then click **OK**.</span></span>

    - <span data-ttu-id="a72d1-204">이제 활동은 **RuleSetToolkitUsageSample Components** 범주의 도구 상자에 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-204">The activity should now appear in the toolbox in the **RuleSetToolkitUsageSample Components** category.</span></span>

7. <span data-ttu-id="a72d1-205">RuleSet 서비스는 Program.cs에서 다음 문을 사용하여 콘솔 애플리케이션 호스트에 이미 구성되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-205">The RuleSet service is already configured on the console application host using the following statement in Program.cs.</span></span>

    ```csharp
    workflowRuntime.AddService(new RuleSetService());
    ```

8. <span data-ttu-id="a72d1-206">구성 파일을 사용하여 호스트에 서비스를 구성할 수도 있습니다. 자세한 내용은 SDK 설명서를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="a72d1-206">You can also configure the service on the host using a configuration file; see the SDK documentation for details.</span></span>

9. <span data-ttu-id="a72d1-207">애플리케이션 구성 파일이 워크플로 프로젝트에 추가되어 서비스에서 사용할 데이터베이스에 대한 연결 문자열을 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-207">An application configuration file is added to the workflow project to specify the connection string for the database to be used by the service.</span></span> <span data-ttu-id="a72d1-208">이 문자열은 RuleSet 도구에서 사용하는 연결 문자열과 동일해야 합니다. RuleSet 도구에서 사용하는 연결 문자열은 RuleSet 테이블을 포함하는 데이터베이스를 가리킵니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-208">This should be the same connection string used by the RuleSet tool, which points to the database that contains the RuleSet table.</span></span>

10. <span data-ttu-id="a72d1-209">이제 다른 모든 워크플로 콘솔 애플리케이션처럼 `RuleSetToolkitUsageSample` 프로젝트를 실행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-209">You can now run the `RuleSetToolkitUsageSample` project as you would any other workflow console application.</span></span> <span data-ttu-id="a72d1-210">Visual Studio 내에서 F5 또는 Ctrl + F5 키를 누르거나 RuleSetToolkitUsageSample.exe 파일을 직접 실행 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-210">Press F5 or Ctrl+F5 within Visual Studio or run the RuleSetToolkitUsageSample.exe file directly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="a72d1-211">RuleSet 도구에서는 사용 샘플 어셈블리를 로드하므로 사용 샘플을 다시 컴파일하려면 도구를 닫아야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a72d1-211">You must close the RuleSet tool to recompile the usage sample, because the tool loads the usage sample assembly.</span></span>
